---
name: Payments
route: /payments
menu: Modules
---

# Payments adapter

This will provide a consistent payments mechanism

# Admin

## Create Product

|          route           | method |
| :----------------------: | :----: |
| /admin/payments/products |  POST  |

### Body parameters

- Required
  - name (string)
  - value (int)
  - currency (string): E.g. "USD", "EUR", "KRW". Note that iamport provider will accept only products with "KRW" currency.
- Optional
  - isSubscription (boolean)
  - recurring (string): Required when isSubscription is set to true. Valid values are "day", "week", "month", "year".
  - recurringCount (int): Defaults to 1. The number of intervals (specified in the recurring attribute) between subscription billings. For example, recurring=month and interval_count=3 bills every 3 months.

### Returns

The created product.

Example:

```json
{
  "_id": "string",
  "name": "string",
  "value": "number",
  "currency": "string",
  "isSubscription": "boolean",
  "recurring": "string",
  "recurringCount": "number"
}
```

# Common

## Get Products

|       route        | method | requires authentication |
| :----------------: | :----: | :---------------------: |
| /payments/products |  GET   |          false          |

### Returns

A list of products.

Example:

```json
{
  "products": [
    {
      "_id": "string",
      "name": "string",
      "value": "number",
      "currency": "string",
      "isSubscription": "boolean",
      "recurring": "string",
      "recurringCount": "number"
    }
  ]
}
```

## Get Subscriptions

|          route          | method | requires authentication |
| :---------------------: | :----: | :---------------------: |
| /payments/subscriptions |  GET   |          true           |

### Returns

A list of active subscriptions the requesting user has.

Example:

```json
{
  "subscriptions": [
    {
      "_id": "string",
      "userId": "string",
      "customerId": "string",
      "product": {
        "_id": "string",
        "name": "string",
        "value": "int",
        "currency": "string",
        "isSubscription": "boolean",
        "recurring": "string",
        "recurringCount": "int"
      },
      "iamport": {
        "nextPaymentId": "string"
      },
      "activeUntil": "date formatted to string",
      "provider": "string"
    }
  ]
}
```

# Stripe

These routes will be available ony if stripe handler is enabled.

## Create Payment

|             route              | method | requires authentication |
| :----------------------------: | :----: | :---------------------: |
| /payments/stripe/createPayment |  POST  |          false          |

### Body parameters

- Required
  - productId (string)
- Optional
  - userId (string)
  - saveCard (boolean): If true the card the user will use to pay can be used again without prompting.

### Returns

- clientSecret. Use this in the front end to open the stripe dialog for the user's card information
- paymentId

## Create Payment With Saved Card

|                    route                    | method | requires authentication |
| :-----------------------------------------: | :----: | :---------------------: |
| /payments/stripe/createPaymentWithSavedCard |  POST  |          true           |

### Body parameters

- Required
  - productId (string)
  - cardId (string): See [Get Payment Methods](#get-payment-methods)

### Returns

- clientSecret
- paymentId (if the payment was successful)
- paymentMethod (if the payment failed and authentication is required)

## Cancel Payment

|             route              | method | requires authentication |
| :----------------------------: | :----: | :---------------------: |
| /payments/stripe/cancelPayment |  PUT   |          false          |

You can cancel a PaymentIntent if you no longer intend to use it to collect payment from the customer. Canceling a
PaymentIntent is optional, and itâ€™s okay to keep a PaymentIntent in an incomplete status like requires_confirmation or requires_payment_method.

### Body parameters

- Required
  - paymentId (string)
- Optional
  - userId (string)

## Refund Payment

|             route              | method | requires authentication |
| :----------------------------: | :----: | :---------------------: |
| /payments/stripe/refundPayment |  PUT   |          false          |

### Body parameters

- Required
  - paymentId (string)
- Optional
  - userId (string)

## Get Payment Methods

|               route                | method | requires authentication |
| :--------------------------------: | :----: | :---------------------: |
| /payments/stripe/getPaymentMethods |  GET   |          true           |

### Returns

A list of the payment methods the requesting user has for transactions with stripe.

Example:

```json
{
  "paymentMethods": {
    "data": [
      {
        "id": "string, this will be used to create payment with saved card",
        "billing_details": {
          "address": {
            "city": "string",
            "country": "string",
            "line1": "string",
            "line2": "string",
            "postal_code": "string",
            "state": "string"
          },
          "email": "string",
          "name": "string",
          "phone": "string"
        },
        "card": {
          "brand": "string e.g. 'visa'",
          "checks": {
            "address_line1_check": "string",
            "address_postal_code_check": "string",
            "cvc_check": "string"
          },
          "country": "string",
          "exp_month": "number",
          "exp_year": "number",
          "fingerprint": "string",
          "funding": "string",
          "generated_from": "string",
          "last4": "string",
          "networks": {
            "available": ["string"],
            "preferred": "boolean"
          },
          "three_d_secure_usage": {
            "supported": "boolean"
          },
          "wallet": "string"
        },
        "created": "timestamp",
        "customer": "string",
        "livemode": "boolean",
        "metadata": {},
        "type": "string"
      }
    ],
    "has_more": "boolean"
  }
}
```

## Complete Payment

|                 route                 | method | requires authentication |
| :-----------------------------------: | :----: | :---------------------: |
| /hook/payments/stripe/completePayment |  POST  |          false          |

Add this route to stripe dashboard to save transactions events to database.
